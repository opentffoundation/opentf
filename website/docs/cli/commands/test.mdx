---
description: >-
    The tofu test command performs integration tests of OpenTofu modules.
---

# Command: test

The `tofu test` command runs integration tests to ensure intended behavior of your OpenTofu configuration. It creates real
infrastructure, asserts conditional checks against the attributes of provisioned resources and attempts
to clean up the testing infrastructure upon completion.

## Usage

Usage: `tofu test [options]`

The `test` command executes the automated integration tests defined in `.tftest.hcl` files which OpenTofu will read
from the current configuration and testing directories.

OpenTofu will create real infrastructure according to the definition in the tested configuration. Then, it will
sequentially run the test blocks to perform conditional checks and assertions against attributes of provisioned resources.
Upon tests completion, OpenTofu will attempt to clean up created resources.

_Note_: monitor the test output for successful cleanup.

## General Options

* `-test-directory=path` Set the test directory (default: "tests"). OpenTofu will search for test files in the set directory
as well as in the directly in which `tofu test` was executed.

_Note_ that the path should be relative to the directory in which `tofu test` is called.

* `-filter=testfile` Set the test file *path* within the `test-directory`. The option can be used multiple times to specify several files.
_Note_ that the path shall be relative to the directory where `tofu test` is called.

* `-var 'foo=bar'` Set the input variables of the root module. The option can be used multiple times to set several variables.

* `-var-file=filename` Set the path to the file with variables values in addition to the default files terraform.tfvars and *.auto.tfvars.
The option can be used multiple times to specify several files.

* `-json` Set for test outputs to be formatted as JSON.

* `-no-color` Disable color codes in the command output.

* `-verbose` Print the plan or state for each test run block as it executes.

## Usage examples

### Flat structure

**GIVEN** the following OpenTofu module structure:

```commandline
.
├── LICENSE
├── README.md
├── main.tf
├── main.tftest.hcl
├── foo.tf
├── foo.tftest.hcl
├── bar.tf
├── bar.tftest.hcl
├── outputs.tf
└── variables.tf
```

**WHEN** `tofu test` is executed in the project directory,

**THEN** the tests defined in all three files, `main.tftest.hcl`, `foo.tftest.hcl` and `bar.tftest.hcl`, will be run.

**WHEN** `tofu test -filter=foo.tftest.hcl -filter=bar.tftest.hcl` is executed in the project directory,

**THEN** the tests defined in the files `foo.tftest.hcl` and `bar.tftest.hcl` will be run only.

### Nested structure

**GIVEN** the following OpenTofu module structure:

```commandline
.
├── LICENSE
├── README.md
├── foo.tf
├── foo.tftest.hcl
├── bar.tf
├── bar.tftest.hcl
├── main.tf
├── main.tftest.hcl
├── tests
│   ├── foo.tftest.hcl
│   └── bar.tftest.hcl
├── modules
│   ├── module_foo
│   │   ├── LICENSE
│   │   ├── README.md
│   │   ├── foo.tf
│   │   ├── foo.tftest.hcl
│   │   ├── main.tf
│   │   ├── main.tftest.hcl
│   │   ├── outputs.tf
│   │   └── variables.tf
│   └── module_bar
│       ├── LICENSE
│       ├── README.md
│       ├── foo.tf
│       ├── foo.tftest.hcl
│       ├── bar.tf
│       ├── bar.tftest.hcl
│       ├── main.tf
│       ├── main.tftest.hcl
│       ├── outputs.tf
│       └── variables.tf
├── outputs.tf
└── variables.tf
```

**WHEN** `tofu test` is executed in the project root directory,

**THEN** the tests defined in the following files will be run (note that the files are sorted in the execution order):

- bar.tftest.hcl,
- foo.tftest.hcl,
- main.tftest.hcl,
- tests/bar.tftest.hcl,
- tests/foo.tftest.hcl.

**WHEN** `tofu test -test-directory=modules/module_bar` is executed in the project root directory,

**THEN** the tests defined in the following files will be run (note that the files are sorted in the execution order):

- bar.tftest.hcl,
- foo.tftest.hcl,
- main.tftest.hcl,
- modules/module_bar/bar.tftest.hcl,
- modules/module_bar/foo.tftest.hcl,
- modules/module_bar/main.tftest.hcl.

**WHEN** `tofu test -test-directory=modules/module_bar -filter=bar.tftest.hcl` is executed in the project root directory,

**THEN** the tests defined in the file `bar.tftest.hcl` will be run only.

**WHEN** `tofu test -test-directory=modules/module_bar -filter=modules/module_bar/bar.tftest.hcl` is executed in the project root directory,

**THEN** the tests defined in the file `modules/module_bar/bar.tftest.hcl` will be run only.

## Definition syntax

TBD

## Variables

Tests can be defined using variables specified in several ways.

The variable values will be resolved according to the following order:

1. Environment variables with the prefix `TF_VAR_`;
2. tfvar files specified in terraform.tfvars, *.auto.tfvars;
3. Files specified using the flag `-var-file`;
4. Variables defined using the flag `-var`;
5. Variables from the `variables block` in test file;
6. Variables from the variables block in run block.

_Note_ that the variable's value found at the later step takes precedence over the value at the earlier step.

## Definition examples

TBD
